<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.groupware.project.P_BoardDAO">
    <select id="getlist" resultType="com.groupware.project.P_BoardDTO">
    SELECT a.CommunityID, a.CommunityTitle, b.Name, a.Content, a.Views, a.Likes, a.CreatedTime ,b.Position
    FROM communities a INNER JOIN employees b ON a.AuthorEmployeeID = b.EmployeeID order by CreatedTime desc limit #{param1},#{param2}
    </select>
    <insert id="savepost">
		insert into communities set CommunityTitle=#{param1},Content=#{param2},AuthorEmployeeID=#{param3},CreatedTime=now()
	</insert>

	<select id="view" resultType="com.groupware.project.P_BoardDTO">
		SELECT a.CommunityID,  b.Userid,a.CommunityTitle,b.Name,b.Position, a.Content, a.Views, a.Likes, a.CreatedTime 
		from communities a INNER JOIN employees b ON a.AuthorEmployeeID = b.EmployeeID
		where CommunityID=#{param1} 
	</select>

	<update id="hitup">
		update communities set Views=Views+1 where CommunityID=#{param1}
	</update>

	<insert id="addComment">
		insert into comments set ParentID=#{param1},Content=#{param2},AuthorEmployeeID=#{param3},CreatedTime=now()
	</insert>
	
	<select id="getComment" resultType="com.groupware.project.P_BoardDTO">
		SELECT  a.CommentID,b.Name AS Comment_Name, a.Content AS COMMENT,a.CreatedTime AS Comment_Date, b.Position AS Comment_Position,
		b.Userid AS CmtAuthorID
		FROM comments a INNER JOIN employees b ON a.AuthorEmployeeID = b.EmployeeID
		where a.ParentID = #{param1} 
	</select>

	<delete id="deleteBoard">
		delete from communities where CommunityID=#{param1};
	</delete>
	<delete id="deleteBoardcmt">
		delete from comments where ParentID=#{param1}
	</delete>

	<delete id="deleteComments">
	    delete from comments where CommentID=#{param1}
	</delete>
	<update id="updateboard">
		update communities set CommunityTitle=#{param2},Content=#{param3}
		where CommunityID=#{param1}
	</update>
	<select id="getTotal" resultType="int">
		select count(*) from communities
	</select>

</mapper>
